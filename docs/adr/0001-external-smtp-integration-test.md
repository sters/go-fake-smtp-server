# ADR-0001: 外部SMTPサーバ連携テストの実装

## ステータス
承認済み

## コンテキスト
go-fake-smtp-serverの動作を実際の環境で検証するため、外部からSMTPリクエストを送信し、APIで確認できることをテストする仕組みが必要です。これにより、実際の使用シナリオでの動作確認とドキュメント化が可能になります。

## 決定事項
以下の構成で外部SMTP連携テストを実装します：

1. **ディレクトリ構成**
   ```
   example/
   ├── docker/
   │   ├── Dockerfile
   │   └── docker-compose.yml
   ├── scripts/
   │   ├── send-email.py      # SMTP送信スクリプト
   │   └── test-search-api.sh # 検索APIテストスクリプト
   └── README.md
   ```

2. **Docker構成**
   - 本体アプリケーションのDockerイメージを作成
   - docker-composeで簡単に起動できる環境を提供
   - ポートマッピング: SMTP(10025)、HTTP(11080)

3. **テストクライアント**
   - PythonスクリプトでSMTP通信を実装（標準ライブラリsmtplibを使用）
   - 複数のテストシナリオを含む（To/CC/BCC、プレーンテキスト）

4. **検証スクリプト**
   - curlを使用したシンプルな検証スクリプト
   - 各検索APIエンドポイントのテスト

## 理由
- **Docker化**: 環境差異を吸収し、誰でも同じ環境でテスト可能
- **Pythonスクリプト**: 標準ライブラリのみで信頼性の高いSMTP通信が可能
- **Bashスクリプト（検証用）**: curlとjqで簡潔にAPI検証
- **example/配下**: 本体コードと分離し、サンプルとして明確化

## 代替案
1. **Makefileターゲット**: より簡潔だが、Dockerの利点を活かせない
2. **Bashスクリプトのみ**: netcatの実装差異により環境依存の問題が発生
3. **テストフレームワーク統合**: 過度に複雑

## 影響
- **ポジティブ**:
  - 実際の使用例として機能
  - 統合テストとして活用可能
  - ドキュメントとしての役割
  - Python標準ライブラリのみで動作
- **ネガティブ**:
  - メンテナンスコストの増加
  - Dockerfileの管理が必要